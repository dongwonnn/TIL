> ì›í‹°ë“œ í”„ë¦¬ì˜¨ë³´ë”© ì²« ë²ˆì§¸ ê³¼ì œì˜ ì£¼ìš” ê¸°ëŠ¥ì¸ **Infinity Scroll**ì— ê´€í•œ ê¸€ì…ë‹ˆë‹¤.

### ê´€ë ¨ ìë£Œ

#### [ğŸ”— í…ŒìŠ¤íŠ¸ ë§í¬](https://pob-coconut.github.io/Assignment1-JC-DW/)

#### [ğŸ”— ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œ](https://github.com/POB-Coconut/Assignment1-JC-DW)

#### ì•Œì•„ì•¼ í•  ê²ƒ

`reduxì™€` `redux-saga`ë¥¼ ì´ìš©í•´ ì „ì—­ ìƒíƒœ ê´€ë¦¬, ë¹„ë™ê¸° ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í–ˆìŠµë‹ˆë‹¤.
ì•ìœ¼ë¡œ ë‚˜ì˜¤ëŠ” ì´ë²¤íŠ¸ë“¤ì— ì˜í•´ `page`ê°€ ë³€í•˜ê²Œ ë˜ê³ , í•´ë‹¹ `page`ì— ë§ëŠ” ë°ì´í„°ë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

```javascript
useEffect(() => {
  dispatch(fetchCommentsRequest(page));
}, [dispatch, page]);
```

## â™¾ï¸ Infinity Scroll êµ¬í˜„ ë°©ë²•ë“¤

### âš™ï¸ Scroll Event

`ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸`ì™€ `height`ë¥¼ ì´ìš©í•œ ë°©ë²•ì…ë‹ˆë‹¤.

```javascript
useEffect(() => {
  function onScroll() {
    // window.scrollY : ë‚´ê°€ ë³´ê³  ìˆëŠ” í™”ë©´ì˜ ìµœìƒë‹¨ ì§€ì ì˜ ë†’ì´. ì¦‰ ìŠ¤í¬ë¡¤ì„ í†µí•´ ë‚´ë¦° height.
    // document.documentElement.clientHeight : ë‚´ ëª¨ë‹ˆí„° í™”ë©´ì˜ height.
    // document.documentElement.scrollHeight : í˜ì´ì§€ì˜ ì´ ë†’ì´ height.
    if (
      window.scrollY + document.documentElement.clientHeight >
      document.documentElement.scrollHeight - 300
    ) {
      // ì¡°ê±´ ë§Œì¡± ì‹œ ë‹¤ìŒ í˜ì´ì§€ Set
      const nextPage = page + 1;
      setPage(nextPage);
    }
  }

  window.addEventListener("scroll", onScroll);
  return () => {
    // ë’·ì •ë¦¬ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ìŠ¤í¬ë¡¤ì´ ëë‚˜ë©´ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ì œê±°
    window.removeEventListener("scroll", onScroll);
  };
}, [page]);
```

#### ì¥ì 

1. **ì§ê´€ì **ì…ë‹ˆë‹¤. `height`ë¥¼ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— ë¬´ìŠ¨ ì˜ë¯¸ì¸ì§€ í•œëˆˆì— ì•Œì•„ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
2. **ë¶€ë“œëŸ¬ìš´ UI**. í˜ì´ì§€ì˜ ì´ ë†’ì´ì—ì„œ -300 ì •ë„ ê°’ì„ ë¹¼ ë§¨ ëì— ë‹¿ê¸° ì „ì— ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œí•  ìˆ˜ ìˆì–´ ë¶€ë“œëŸ¬ìš´ UIë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

#### ë‹¨ì 

1. ìŠ¤í¬ë¡¤ í•  ë•Œë§ˆë‹¤ **ìˆ˜ë§ì€ ì´ë²¤íŠ¸ê°€ ë°œìƒ**í•©ë‹ˆë‹¤. **ë Œë”ë§ ë¬¸ì œ**ê°€ ìˆì„ ìˆ˜ ìˆê³  ì´ë¥¼ ì¡°ì ˆí•˜ê¸° ìœ„í•´ `throttle`ì„ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆìŠµë‹ˆë‹¤.
2. **dispatch ì—­ì‹œ ì§§ì€ ì‹œê°„ì— ë‹¤ìˆ˜ ë°œìƒí•©ë‹ˆë‹¤.** **ìì› ë‚­ë¹„**ê°€ ë  ìˆ˜ ìˆê³  ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ redux-sagaì˜ effectì¸ `throttle`ì„ ì´ìš©í•´ í•´ê²°í•´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆìŠµë‹ˆë‹¤.

### âš™ï¸ Intersection Observer API

ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ê°€ heightë¥¼ ì´ìš©í•œë‹¤ë©´` Intersection Observer`ì€ êµ¬ì—­ì„ ì´ìš©í•˜ëŠ” ëŠë‚Œì…ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ ë·°í¬íŠ¸ì™€ ì„¤ì •í•œ ìš”ì†Œì— í¬ì°©ëœë‹¤ë©´ ë°œìƒí•©ë‹ˆë‹¤.

```javascript
const [target, setTarget] = useState(null);

useEffect(() => {
  let observer;
  const _onIntersect = ([entry]) => {
    // í¬ì°© ëœ ê²½ìš°
    if (entry.isIntersecting) {
      const nextpage = page + 1;
      setPage(nextpage);
    }
  };
  if (target) {
    // observer ìƒì„±, ê°€ì‹œì„± ë²”ìœ„ ì„¤ì •
    observer = new IntersectionObserver(_onIntersect, { threshold: 1 });

    // ì„¤ì •í•œ ìš”ì†Œ ê´€ì°°
    observer.observe(target);
  }
  // observer ì‚­ì œ
  return () => observer && observer.disconnect();
}, [page, target, fetchLoading]);

return (
  <div>
    <CardList />
    <div ref={setTarget}>loading</div>
  </div>
);
```

#### ì¥ì 

1. scorll ì´ë²¤íŠ¸ **ì—°ì† í˜¸ì¶œì„ ì œì–´**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ dispatch ë°œìƒ ë˜í•œ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ë‹¨ì 

1.  ì € ê°™ì€ ê²½ìš° Infinity Scrollê³¼ ê°™ì´ ë§¨ ë°‘ì— ë§Œì„ ê´€ì°°í•˜ëŠ” ê²½ìš°ì—ëŠ” ì‰½ê²Œ ì‚¬ìš©í–ˆì§€ë§Œ Scroll SPYì™€ ê°™ì´ **ì„¸ë°€í•œ heightë¥¼ ê³„ì‚°í•˜ëŠ” ê²½ìš°** ê°€ì‹œì„±ì˜ ë²”ìœ„ë¥¼ êµ¬í•˜ëŠ”ë° ì• ë¥¼ ë¨¹ê³  í¬ê¸°í•œ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤. (~~ì €ë§Œ ì–´ë ¤ìš¸ ìˆ˜ë„..~~)

### âš™ï¸ react-intersection-observer íŒ¨í‚¤ì§€

react-intersection-observer íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í–ˆê³  ìµœì¢…ì ìœ¼ë¡œ ì„ íƒí•œ ë°©ë²•ì…ë‹ˆë‹¤. **useInView hookì„ ì´ìš©í•œ ê°„ë‹¨í•œ ì‚¬ìš©ë²•ê³¼ ê·¸ë¡œ ì¸í•œ ì§§ì€ ì½”ë“œ ê¸¸ì´**ê°€ íŠ¹ì§•ì…ë‹ˆë‹¤.

```javascript
import { useInView } from "react-intersection-observer";

...

// ref ì„¤ì •ê³¼ ê´€ì°° ì—¬ë¶€ ë³€ìˆ˜
const [ref, inView] = useInView();

useEffect(() => {
  // ê´€ì°°
  if (inView) {
    dispatch(fetchCommentsRequest(page));

    const nextPage = page + 1;
    setPage(nextPage);
  }
}, [inView, page, dispatch]);

return (
  <>
    <CommentList />
    // ê´€ì°° ìš”ì†Œ
    <div ref={ref} />
  </>
);
```

## âœ”ï¸ ê³ ë ¤í•  ì 

### ğŸ¤” í™”ë©´ì— DOMì´ ê·¸ë ¤ì§€ê¸° ì „ì— ê´€ì°°í•  ìš”ì†Œê°€ ê´€ì°° ë‹¹í•´ë²„ë¦°ë‹¤ë©´

ë¬´ìŠ¨ ì†Œë¦¬ëƒë©´.. ìš”ì†Œë¥¼ ê´€ì°°í•˜ê¸° ìœ„í•´ ë§Œë“  domì´ ì•„ì§ ë°ì´í„°ë¥¼ ëª» ë°›ì•„ì™€ domì„ ëª» ê·¸ë¦¬ê³  ìˆì„ ë•Œ ë·°í¬íŠ¸ì— ê´€ì°° ë‹¹í•´ë²„ë¦¬ë©´ ì–´ë–»ê²Œ ë˜ëƒëŠ” ì˜ë¯¸ ì…ë‹ˆë‹¤. (?)

ë‹¹ì—°íˆ ê°ì§€ë˜ì–´ dispatchê°€ ë°œìƒí•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì™œì¸ì§€ dispatchê°€ ë¬´í•œíˆ ë°œìƒí•´ í„°ì ¸ë²„ë ¸ìŠµë‹ˆë‹¤.

<img src="https://user-images.githubusercontent.com/59330828/127199881-8dbcf0d3-4932-411f-b2b5-930abde18b93.PNG">

#### ğŸ¯ í•´ê²° ë°©ë²•

`fetchLoading` ë³€ìˆ˜ë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤. `fetchLoading`ì´ `false` ì¼ ë•Œ ì¦‰, `REQUEST`ê°€ ëë‚œ `SUCCESS`, `FAILURE` ìƒíƒœì¼ ë•Œë§Œ í˜¸ì¶œë˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

```javascript
// comment reducer
const comment = (state = initialStete, action) => {
  switch (action.type) {
      // ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë•Œ fetchLoadingì„ trueë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
      // ìš”ì²­ì´ SUCCESS, FAILURE ëì„ ë•Œ falseë¡œ ë³€í•©ë‹ˆë‹¤.
    case FETCH_COMMENTS_REQUEST:
      return {
        ...state,
        fetchDone: false,
        fetchError: null,
        fetchLoading: true,
      };
    ...
  }
};
```

```javascript
// ì»´í¬ë„ŒíŠ¸
useEffect(() => {
  // fetchLoadingê°€ flaseì¼ ë•Œ, ì¦‰ request ìƒíƒœê°€ ì•„ë‹ë•Œë§Œ ë°œìƒí•©ë‹ˆë‹¤.
  if (inView && !fetchLoading) {
    dispatch(fetchCommentsRequest(page));

    const nextPage = page + 1;
    setPage(nextPage);
  }
}, [inView, page, fetchLoading, hasMoreComments, dispatch]);
```

### ğŸ¤” í˜ì´ì§€ì˜ ëê¹Œì§€ ìŠ¤í¬ë¡¤ í•´ ë” ì´ìƒ ë¶ˆëŸ¬ì˜¬ ë°ì´í„°ê°€ ì—†ë‹¤ë©´ ?

ë§Œì•½ ëê¹Œì§€ ìŠ¤í¬ë¡¤ í•´ ë” ì´ìƒ ë¶ˆëŸ¬ì˜¬ ë°ì´í„°ê°€ ì—†ë‹¤ë©´ ì–´ë–»ê²Œ ë ì§€ ê³ ë ¤í•´ë´¤ìŠµë‹ˆë‹¤. **postman**ìœ¼ë¡œ í™•ì¸í•´ë³¸ ê²°ê³¼ ì´ 500ê°œì˜ ëŒ“ê¸€ì´ ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆê³  50ë²ˆ ìŠ¤í¬ë¡¤ í•´ì„œ ë§ˆì§€ë§‰ê¹Œì§€ ìŠ¤í¬ë¡¤ í•´ë´¤ìŠµë‹ˆë‹¤. ( ~~limitì„ ë°”ê¾¸ë©´ í•œ ë²ˆì— í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤..~~ )

ë” ì´ìƒ ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ì–´ ê°™ì€ ë·°í¬íŠ¸ì— ë¨¸ë¬¼ëŸ¬ ìˆê¸° ë•Œë¬¸ì— ìˆ˜ë§ì€ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

<img src="https://user-images.githubusercontent.com/59330828/127201859-c5ebbb92-0994-476c-9830-9708f8855115.PNG" alt="">

#### ğŸ¯ í•´ê²° ë°©ë²•

ì§€ê¸ˆì´ ë§ˆì§€ë§‰ í˜ì´ì§€ë¼ëŠ” ê²ƒì„ ì•Œë ¤ì¤„ `hasMoreComments` ë³€ìˆ˜ë¡œ í•´ê²°í–ˆìŠµë‹ˆë‹¤. fetch ìš”ì²­ì´ ì„±ê³µí–ˆì„ ë•Œ, ë°›ì•„ì˜¨ ë°ì´í„°ë“¤ì˜ ê¸¸ì´ë¥¼ ì´ìš©í•´, **ë°›ì•„ì˜¨ ë°ì´í„°ì˜ ê°œìˆ˜ê°€ 0ê°œ**ë¼ë©´ ë” ì´ìƒ ë°›ì•„ì˜¬ ë°ì´í„°ê°€ ì—†ìŒì„ ì´ìš©í–ˆìŠµë‹ˆë‹¤.
`hasMoreCommentsë¥¼` ì´ìš©í•´ `dispatch` ë°œìƒ ì—¬ë¶€ë¥¼ ê²°ì •í–ˆìŠµë‹ˆë‹¤.

```javascript
// comment reducer
const comment = (state = initialStete, action) => {
  switch (action.type) {
    case FETCH_COMMENTS_SUCCESS:
      return {
        ...state,
        // ë°›ì•„ì˜¬ ë°ì´í„°ê°€ ë‚¨ì•„ ìˆë‚˜ìš”?
        hasMoreComments: action.payload.length !== 0,
        comments: state.comments.concat(action.payload),
        fetchDone: true,
        fetchError: null,
        fetchLoading: false,
      };
  }
};
```

```javascript
useEffect(() => {
  // ê´€ì°° ë˜ì–´ì•¼ í•˜ê³ , ë¡œë”©ë„ ëë‚˜ì•¼í•˜ê³ , ë” ë°›ì•„ì˜¬ ë°ì´í„°ë„ ìˆì–´ì•¼ì§€ ë‹¤ìŒ í˜ì´ì§€ ë¡œë”©
  if (inView && !fetchLoading && hasMoreComments) {
    dispatch(fetchCommentsRequest(page));

    const nextPage = page + 1;
    setPage(nextPage);
  }
}, [inView, page, fetchLoading, hasMoreComments, dispatch]);

return (
  <>
    <CommentList />
    <div ref={hasMoreComments && !fetchLoading ? ref : undefined} />
  </>
);
```
